<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libro de Recetas ğŸ³</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1 id="pageTitle">Libro de Recetas ğŸ“–</h1>
            <div class="language-selector">
                <label for="languageSelect">ğŸŒ Idioma:</label>
                <select id="languageSelect" onchange="changeLanguage()">
                    <option value="ro">RomÃ¢nÄƒ ğŸ‡·ğŸ‡´</option>
                    <option value="en">English ğŸ‡¬ğŸ‡§</option>
                    <option value="es" selected>EspaÃ±ol ğŸ‡ªğŸ‡¸</option>
                </select>
            </div>
        </div>
    </header>
    <main>
        <div class="container">
            <h2 id="recipesTitle">Nuestras Recetas ğŸ¥˜</h2>
            <div class="category-filter">
                <label id="filterLabel" for="categorySelect"></label>
                <select id="categorySelect" onchange="filterRecipes()">
                    <option value="all">Todas ğŸŒŸ</option>
                </select>
            </div>
            <div id="recipesContainer"></div>
        </div>
    </main>
    <footer>
        <div class="container">
            <p id="footerText">&copy; 2023 Libro de Recetas ğŸ´</p>
        </div>
    </footer>

    <!-- Modal para mostrar la receta completa -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modalRecipeName"></h3>
            <p><strong>ğŸ›’ Ingredientes:</strong></p>
            <ul id="modalIngredientsList"></ul>
            <p><strong>ğŸ“ Instrucciones:</strong></p>
            <ul id="modalInstructionsList"></ul>
        </div>
    </div>

    <script>
        // Variables globales
        let currentLanguage = 'es';
        let translations = {};
        let recipesData = [];
        let categories = [];

        // Cargar traducciones desde translations.json
        async function loadTranslations() {
            try {
                const response = await fetch('translations.json');
                translations = await response.json();
                updateTexts();
            } catch (error) {
                console.error('Error al cargar las traducciones:', error);
            }
        }

        // Cargar recetas desde recipes.json
        async function loadRecipes() {
            try {
                const response = await fetch('recipes.json');
                recipesData = await response.json();
                extractCategories();
                renderRecipes();
            } catch (error) {
                console.error('Error al cargar las recetas:', error);
            }
        }

        // Extraer categorÃ­as Ãºnicas
        function extractCategories() {
            categories = [...new Set(recipesData.map(recipe => recipe.category))];
            populateCategoryFilter();
        }

        // Poblar el filtro de categorÃ­as con emojis
        function populateCategoryFilter() {
            const categorySelect = document.getElementById('categorySelect');
            categorySelect.innerHTML = `<option value="all">${translations[currentLanguage].allCategories} ğŸŒŸ</option>`;
            categories.forEach(category => {
                const emoji = getCategoryEmoji(category);
                const option = document.createElement('option');
                option.value = category;
                option.textContent = `${emoji} ${translations[currentLanguage].categories[category]}`;
                categorySelect.appendChild(option);
            });
        }

        // Obtener emoji segÃºn la categorÃ­a
        function getCategoryEmoji(category) {
            const emojis = {
                "Postres": "ğŸ°",
                "Pastas": "ğŸ",
                "Ensaladas": "ğŸ¥—",
                "Sopas": "ğŸ²",
                "Carnes": "ğŸ–",
                "Pescados": "ğŸŸ",
                "Bebidas": "ğŸ¹",
                "PanaderÃ­a": "ğŸ"
            };
            return emojis[category] || "ğŸ´"; // Emoji por defecto si no hay coincidencia
        }

        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            updateTexts();
            populateCategoryFilter();
            renderRecipes();
        }

        function filterRecipes() {
            renderRecipes();
        }

        function updateTexts() {
            const lang = translations[currentLanguage];
            document.getElementById('pageTitle').innerText = `${lang.pageTitle} ğŸ“–`;
            document.getElementById('recipesTitle').innerText = `${lang.recipesTitle} ğŸ¥˜`;
            document.getElementById('footerText').innerHTML = `&copy; 2023 ${lang.footerText} ğŸ´`;
            document.getElementById('filterLabel').innerText = `${lang.filterByCategory} ğŸ”`;
        }

        function renderRecipes() {
            const container = document.getElementById('recipesContainer');
            container.innerHTML = '';

            const selectedCategory = document.getElementById('categorySelect').value;

            const filteredRecipes = selectedCategory === 'all'
                ? recipesData
                : recipesData.filter(recipe => recipe.category === selectedCategory);

            filteredRecipes.forEach(recipe => {
                const recipeDiv = document.createElement('div');
                recipeDiv.classList.add('recipe-item');

                // Obtener la traducciÃ³n de la receta segÃºn el idioma actual
                const translatedRecipe = recipe.translations[currentLanguage];

                // Dividir las instrucciones en pasos numerados
                const steps = translatedRecipe.instructions.split('. ').filter(step => step.trim() !== '');

                recipeDiv.innerHTML = `
                    <h3>${getCategoryEmoji(recipe.category)} ${translatedRecipe.name} ğŸ½ï¸</h3>
                    <p><strong>ğŸ›’ Ingredientes:</strong></p>
                    <ul class="ingredients-list">
                        ${translatedRecipe.ingredients.slice(0, 3).map(ingredient => `<li>${ingredient}</li>`).join('')}
                        <li class="show-more">... Ver mÃ¡s</li>
                    </ul>
                `;
                recipeDiv.querySelector('.show-more').addEventListener('click', () => openRecipeModal(recipe));
                container.appendChild(recipeDiv);
            });
        }

        // Abrir el modal con la receta completa
        function openRecipeModal(recipe) {
            const modal = document.getElementById('recipeModal');
            const closeBtn = modal.querySelector('.close-button');
            const modalRecipeName = document.getElementById('modalRecipeName');
            const modalIngredientsList = document.getElementById('modalIngredientsList');
            const modalInstructionsList = document.getElementById('modalInstructionsList');

            // Obtener la traducciÃ³n de la receta segÃºn el idioma actual
            const translatedRecipe = recipe.translations[currentLanguage];

            // Dividir las instrucciones en pasos numerados
            const steps = translatedRecipe.instructions.split('. ').filter(step => step.trim() !== '');

            // Rellenar el modal con los datos de la receta
            modalRecipeName.innerText = `${getCategoryEmoji(recipe.category)} ${translatedRecipe.name} ğŸ½ï¸`;
            modalIngredientsList.innerHTML = translatedRecipe.ingredients.map(ingredient => `<li>${ingredient}</li>`).join('');
            modalInstructionsList.innerHTML = steps.map((step, index) => `<li>Paso ${index + 1}: ${step.trim()}</li>`).join('');

            // Mostrar el modal
            modal.style.display = 'block';

            // Cerrar el modal al hacer clic en la "X"
            closeBtn.onclick = () => {
                modal.style.display = 'none';
            };

            // Cerrar el modal al hacer clic fuera de Ã©l
            window.onclick = event => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        }

        // Cargar traducciones y recetas al iniciar
        window.onload = async () => {
            await loadTranslations();
            await loadRecipes();
        };
    </script>
</body>
</html>
